clear
echo "\n\n=========================================="
echo "当您看到这条消息时说明热更新SH正在运行，请不要退出，我们将进行模块的更新以及刷入"
echo "==========================================\n"

sleep 2

echo "=========================================="
echo "           开始获取模块包"
echo "==========================================\n"

busybox wget "https://123-184-221-20.pd1.cjjd19.com:30443/download-cdn.123295.com/123-404/5e23bafc/1707985-0/5e23bafcf305715f674d5c93d1b3d594/c-m86?v=5&t=1753456477&s=17534564773adb28a7412c241bcd9fe43d17847485&r=E54DD4&bzc=2&bzs=313730373938353a32333138363239373a32383730303735353a30&bzp=0&bi=1388116533&filename=HideOne_v2.5b.zip&x-mf-biz-cid=804f05d8-eb6e-458b-8c31-756b594b9c5c-6eaa77&auto_redirect=0&cache_type=1&ndcp=1&xmfcid=e455734b-4d27-465c-8649-74131a03e6cc68a09c88be1" -O /data/local/tmp/Hidemodule.zip

if [ -f "/data/local/tmp/Hidemodule.zip" ]; then
    echo "\n=========================================="
    echo "        下载成功，准备执行模块的刷入命令"
    echo "==========================================\n"
    sleep 2
    
    echo "=========================================="
    echo "            开始执行刷入命令"
    echo "==========================================\n"
    
    # 切换到临时目录
    cd /data/local/tmp/
    
    # KSU模块安装命令
    ksu_install_cmd="/data/adb/ksud"
    
    # 检查KSU是否可用
    if [ -f "$ksu_install_cmd" ]; then
        # 使用KSU安装模块
        $ksu_install_cmd module install Hidemodule.zip
        
        # 检查安装结果
        if [ $? -eq 0 ]; then
            echo "\n=========================================="
            echo "       Hidemodule.zip 刷入成功！"
            echo "==========================================\n"
            
            # 刷入成功后等待10秒
            echo "\n=========================================="
            echo "      请不要退出，接下来将删除临时文件 请稍等"
            echo "==========================================\n"
            sleep 10
            
            # 删除模块文件和更新脚本
            rm -f /data/local/tmp/Hidemodule.zip
            rm -f /data/local/tmp/Update1.sh
            
            echo "\n=========================================="
            echo "      临时文件已成功删除！"
            echo "==========================================\n"
        else
            echo "\n=========================================="
            echo "       Hidemodule.zip 刷入失败！"
            echo "==========================================\n"
        fi
    else
        echo "\n=========================================="
        echo "  错误：未找到KernelSU安装程序(ksud)！"
        echo "==========================================\n"
    fi
else
    echo "\n=========================================="
    echo "         下载失败，请检查网络或重试！"
    echo "==========================================\n"
fi
            echo "\n=========================================="
            echo "     接下来需要重启设备保证模块生效 10秒后重启"
            echo "==========================================\n"
            sleep 10
      reboot