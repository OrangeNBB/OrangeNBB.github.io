clear
echo "\n\n=========================================="
echo "当您看到这条消息时说明热更新SH正在运行，请不要退出，我们将进行模块的更新以及刷入"
echo "==========================================\n"

sleep 2

echo "=========================================="
echo "           开始获取模块包"
echo "==========================================\n"

busybox wget "https://123-184-221-20.pd1.cjjd19.com:30443/download-cdn.123295.com/123-404/5e23bafc/1707985-0/5e23bafcf305715f674d5c93d1b3d594/c-m86?v=5&t=1753456477&s=17534564773adb28a7412c241bcd9fe43d17847485&r=E54DD4&bzc=2&bzs=313730373938353a32333138363239373a32383730303735353a30&bzp=0&bi=1388116533&filename=HideOne_v2.5b.zip&x-mf-biz-cid=804f05d8-eb6e-458b-8c31-756b594b9c5c-6eaa77&auto_redirect=0&cache_type=1&ndcp=1&xmfcid=e455734b-4d27-465c-8649-74131a03e6cc68a09c88be1" -O /data/local/tmp/AlphaHide.zip

if [ -f "/data/local/tmp/AlphaHide.zip" ]; then
    echo "\n=========================================="
    echo "        下载成功，准备执行模块的刷入命令"
    echo "==========================================\n"
    sleep 2
    
    echo "=========================================="
    echo "            开始执行刷入命令"
    echo "==========================================\n"
    
    # 切换到临时目录
    cd /data/local/tmp/
    
    # Magisk模块安装命令
    magisk_install_cmd="magisk"
    
    # 检查Magisk是否可用
    if [ -f "/data/adb/magisk" ] || which $magisk_install_cmd >/dev/null 2>&1; then
        # 使用Magisk安装模块
        magisk --install-module AlphaHide.zip
        
        # 检查安装结果
        if [ $? -eq 0 ]; then
            echo "\n=========================================="
            echo "       AlphaHide.zip 刷入成功！"
            echo "==========================================\n"
            
            # 刷入成功后等待10秒
            echo "\n=========================================="
            echo "      请不要退出，接下来将删除临时文件 请稍等"
            echo "==========================================\n"
            sleep 10
            
            # 删除模块文件和更新脚本
            rm -f /data/local/tmp/hma.apk
            rm -f /data/local/tmp/AlphaHide.zip
            rm -f /data/local/tmp/DownloadSH2.sh
            
            echo "\n=========================================="
            echo "      临时文件已成功删除！"
            echo "==========================================\n"
            sleep 2
echo "\n=========================================="
echo "     清理已完成，将在20秒后重启设备以启用模块"
echo "==========================================\n"
echo "\n=========================================="
echo "     部分机型重启命令执行后不会重启而是黑屏\n   若黑屏无响应请自行长按音量开机"
echo "==========================================\n"
sleep 21
reboot
        else
            echo "\n=========================================="
            echo "       AlphaHide.zip 刷入失败！"
            echo "==========================================\n"
        fi
    else
        echo "\n=========================================="
        echo "  错误：未找到Magisk安装程序 您的设备可能没有正确安装Magisk"
        echo "==========================================\n"
    fi
else
    echo "\n=========================================="
    echo "         下载失败，请检查网络或重试！"
    echo "==========================================\n"
fi
            